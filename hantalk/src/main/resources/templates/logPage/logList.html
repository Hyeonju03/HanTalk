<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HanTalk - 로그 데이터</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    .break-words {
      word-break: break-all;
      overflow-wrap: break-word;
    }
  </style>
</head>
<body class="bg-[#f3f4f6] min-h-screen flex flex-col">

<div th:replace="~{fragments/header :: headerFragment(isLoggedIn=${isLoggedIn})}"></div>

<div class="flex-grow flex justify-center">
  <div class="flex-1 flex flex-col p-4 w-full">
    <main class="bg-white rounded-xl shadow-xl mx-auto flex-grow w-full">
      <div class="p-8">
        <div class="flex items-center justify-between mb-10 w-full">
          <div class="flex-1"></div>
          <h1 class="text-4xl font-bold text-[#2F4160] mb-0">로그 데이터</h1>
          <div class="flex-1 text-right">
            <a href="/admin" class="inline-block bg-[#2F4160] text-white py-3 px-6 rounded-lg shadow-md hover:bg-[#4B4B4B] transition-colors duration-300 flex items-center">
              관리자 페이지로 <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>
        </div>

        <div th:if="${filter}" class="bg-[#B5D0E3] text-[#2F4160] font-semibold py-3 px-6 rounded-lg shadow-md mb-6 mx-auto w-fit">
          [[${filter}]]
        </div>

        <div class="flex flex-wrap justify-center gap-4 mb-8">
          <button onclick="showFilter('allLogs')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            전체 로그 보기
          </button>
          <button onclick="showFilter('userFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            사용자별
          </button>
          <button onclick="showFilter('dateFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            기간별
          </button>
          <button onclick="showFilter('userDateFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            사용자+기간
          </button>
        </div>

        <div id="userFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">사용자별 로그 보기</h3>
          <form method="get" onsubmit="this.action='/user/' + document.getElementById('userNoInput').value; return true;" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="number" id="userNoInput" placeholder="사용자 번호: 예) 1" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="dateFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">기간별 로그 보기</h3>
          <form method="get" action="/date" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="date" name="start" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="end" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="userDateFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">사용자 + 기간별 로그 보기</h3>
          <form method="get" action="/user-date" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="number" name="userNo" placeholder="사용자 번호: 예) 1" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="start" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="end" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="allLogs" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">전체 로그 보기</h3>
          <form method="get" action="/admin/getLogdata">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              전체 로그 보기
            </button>
          </form>
        </div>

        <div class="text-center mb-8">
          <button id="toggleLog" class="px-8 py-4 bg-gray-700 text-white font-bold rounded-lg shadow-lg hover:bg-gray-800 transition-colors duration-300">
            로그 보기
          </button>
        </div>

        <div id="logContainer" class="hidden">
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <table class="min-w-full">
              <thead class="bg-gray-200">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">사용자ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">사용자</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">URI</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">메서드</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">디바이스</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">응답 코드</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">처리 시간(ms)</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">요청 시간</th>
              </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
              <tr th:each="log : ${list}">
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.user.userId}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.user.name}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.uri}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.method}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.device}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.statusCode}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.responseTime}]]</td>
                <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.createDate}]]</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div th:replace="~{fragments/footer :: footerFragment}"></div>

<script>
  function showFilter(id) {
      document.querySelectorAll(".filter-section").forEach(section => {
          section.classList.add("hidden");
      });
      document.getElementById(id).classList.remove("hidden");
  }

  document.addEventListener("DOMContentLoaded", function() {
      const toggleBtn = document.getElementById("toggleLog");
      const logContainer = document.getElementById("logContainer");

      toggleBtn.addEventListener("click", function() {
          logContainer.classList.toggle("hidden");
          const isHidden = logContainer.classList.contains("hidden");
          toggleBtn.textContent = isHidden ? "로그 보기" : "로그 접기";
      });
  });
</script>
</body>
</html>