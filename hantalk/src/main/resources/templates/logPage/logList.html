<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HanTalk - 로그 데이터</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
    body {
      font-family: 'Nanum Gothic', sans-serif;
    }
    /* 테이블 셀 내 텍스트 줄바꿈을 위한 스타일 */
    .break-words {
      word-break: break-all;
      overflow-wrap: break-word;
    }
  </style>
</head>
<body class="bg-[#f3f4f6] min-h-screen flex flex-col items-center p-8">

<div th:replace="~{fragments/header :: headerFragment}"></div>

<div class="container mx-auto p-4 max-w-7xl flex-1">
  <div class="bg-white p-6 rounded-lg shadow-md">

    <main class="w-full mx-auto flex-grow">
      <div class="mx-auto px-4 py-8">

        <!-- '로그 데이터' 제목은 중앙에, '관리자 페이지' 버튼은 오른쪽에 배치 -->
        <div class="relative flex items-center mb-10">
          <h1 class="text-4xl font-bold text-[#2F4160] w-full text-center">로그 데이터</h1>
          <a th:href="@{/admin}" class="absolute right-0 top-1/2 -translate-y-1/2 inline-block bg-[#2F4160] text-white px-6 py-3 rounded-lg shadow-md hover:bg-[#4B4B4B] transition-colors duration-300 flex items-center">
            관리자 페이지로 <i class="fas fa-arrow-right ml-2"></i>
          </a>
        </div>

        <div th:if="${filter}" class="bg-[#B5D0E3] text-[#2F4160] font-semibold py-3 px-6 rounded-lg shadow-md mb-6 mx-auto w-fit">
          [[${filter}]]
        </div>

        <div class="flex flex-wrap justify-center gap-4 mb-8">
          <button onclick="showFilter('allLogs')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            전체 로그 보기
          </button>
          <button onclick="showFilter('userFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            사용자별
          </button>
          <button onclick="showFilter('dateFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            기간별
          </button>
          <button onclick="showFilter('userDateFilter')" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
            사용자+기간
          </button>

        </div>

        <div id="userFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">사용자별 로그 보기</h3>
          <form method="get" onsubmit="this.action='/user/' + document.getElementById('userNoInput').value; return true;" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="number" id="userNoInput" placeholder="사용자 번호: 예) 1" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="dateFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">기간별 로그 보기</h3>
          <form method="get" action="/date" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="date" name="start" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="end" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="userDateFilter" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">사용자 + 기간별 로그 보기</h3>
          <form method="get" action="/user-date" class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="number" name="userNo" placeholder="사용자 번호: 예) 1" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="start" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <input type="date" name="end" required class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              검색
            </button>
          </form>
        </div>

        <div id="allLogs" class="filter-section bg-white p-6 rounded-lg shadow-md mx-auto mb-8 hidden">
          <h3 class="text-xl font-semibold mb-4 text-[#2F4160]">전체 로그 보기</h3>
          <form method="get" action="/admin/getLogdata">
            <button type="submit" class="px-6 py-3 bg-[#4B4B4B] text-white font-semibold rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
              전체 로그 보기
            </button>
          </form>
        </div>

        <div class="text-center mb-8">
          <button id="toggleLog" class="px-8 py-4 bg-gray-700 text-white font-bold rounded-lg shadow-lg hover:bg-gray-800 transition-colors duration-300">
            로그 보기
          </button>
        </div>

        <div id="logContainer" class="hidden">
          <div class="bg-white rounded-lg shadow-md overflow-hidden mx-auto">
            <div class="h-96 overflow-y-auto">
              <table class="min-w-full">
                <thead class="bg-gray-200 sticky top-0">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">사용자ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">사용자</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">URI</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">메서드</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">디바이스</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">응답 코드</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">처리 시간(ms)</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider break-words">요청 시간</th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                <tr th:each="log : ${list}">
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.user.userId}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.user.name}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.uri}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.method}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.device}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.statusCode}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.responseTime}]]</td>
                  <td class="px-6 py-4 text-sm text-[#2F4160] break-words">[[${log.createDate}]]</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Paging Controls -->
        <div class="flex justify-center items-center mt-8 space-x-2" th:if="${totalPages > 1}">
          <a th:if="${currentPage > 0}" th:href="@{/admin/getLogdata(page=${currentPage - 1}, size=${10})}" class="px-4 py-2 bg-[#4B4B4B] text-white rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
            Previous
          </a>
          <div th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:href="@{/admin/getLogdata(page=${i}, size=${10})}" th:text="${i + 1}" class="px-4 py-2 rounded-lg"
               th:classappend="${i == currentPage} ? 'bg-[#2F4160] text-white' : 'bg-gray-200 text-[#2F4160] hover:bg-gray-300'">
            </a>
          </div>
          <a th:if="${currentPage < totalPages - 1}" th:href="@{/admin/getLogdata(page=${currentPage + 1}, size=${10})}" class="px-4 py-2 bg-[#4B4B4B] text-white rounded-lg hover:bg-[#2F4160] transition-colors duration-300">
            Next
          </a>
        </div>
      </div>
    </main>
  </div>
</div>

<div th:replace="~{fragments/footer :: footerFragment}"></div>

<script>
  function showFilter(id) {
      document.querySelectorAll(".filter-section").forEach(section => {
          section.classList.add("hidden");
      });
      document.getElementById(id).classList.remove("hidden");
  }

  document.addEventListener("DOMContentLoaded", function() {
      const toggleBtn = document.getElementById("toggleLog");
      const logContainer = document.getElementById("logContainer");

      toggleBtn.addEventListener("click", function() {
          logContainer.classList.toggle("hidden");
          const isHidden = logContainer.classList.contains("hidden");
          toggleBtn.textContent = isHidden ? "로그 보기" : "로그 접기";
      });
  });
</script>
</body>
</html>
