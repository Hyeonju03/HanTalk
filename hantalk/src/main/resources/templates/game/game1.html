<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"> <!-- ✅ Thymeleaf 네임스페이스 추가 -->
<head>
    <meta charset="utf-8">
    <title>Typing Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #222;
        }
        #unity-container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #unity-canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="unity-container">
    <canvas id="unity-canvas" width="960" height="600"></canvas>
</div>

<script src="/unity-builds/game1/Build/UnityLoader.js"></script>
<script th:inline="javascript"> <!-- ✅ th:inline="javascript" 추가 -->
    var buildUrl = "/unity-builds/game1/Build";
    var loaderUrl = buildUrl + "/WebGL.json";
    var config = {
        dataUrl: buildUrl + "/WebGL.data",
        frameworkUrl: buildUrl + "/WebGL.framework.js",
        codeUrl: buildUrl + "/WebGL.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "TypingGame",
        productVersion: "1.0",
    };

    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");

    UnityLoader.instantiate("unity-container", loaderUrl, config).then((unityInstance) => {
        window.unityInstance = unityInstance;
    });

    // ✅ Thymeleaf를 사용하여 userNo 값을 모델에서 가져와 JavaScript 변수에 할당
    var userId = [[${userNo}]];

    window.updatePoints = (points) => {
        console.log("Updating points:", points);
        fetch('/game/api/users/updatePoints/' + userId, {
            method: 'PUT', // ✅ PUT으로 수정
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ points: points }) // ✅ userId를 URL에 포함했으므로 body에서 제거
        }).then(response => response.json())
          .then(data => console.log('Success:', data))
          .catch((error) => console.error('Error:', error));
    };
</script>
</body>
</html>