<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì ì˜ìƒ ëª©ë¡</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>ì˜ìƒ ëª©ë¡</h1>
<!-- â• ìƒˆ ì˜ìƒ ë“±ë¡ -->
<a th:href="@{/video/admin/chuga}">â• ìƒˆ ì˜ìƒ ë“±ë¡</a>
<br>

<!-- ğŸ” ê²€ìƒ‰ í¼ -->
<form method="get" th:action="@{/video/admin/list}" id="searchForm">
  <select name="searchType" id="searchType">
    <option value="title" th:selected="${searchType == 'title'}">ì œëª©</option>
    <option value="content" th:selected="${searchType == 'content'}">ë‚´ìš©</option>
    <option value="filename" th:selected="${searchType == 'filename'}">íŒŒì¼ëª…</option>
    <option value="all" th:selected="${searchType == 'all'}">ì œëª© + ë‚´ìš© + íŒŒì¼ëª…</option>
  </select>
  <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" th:value="${keyword}" id="keyword"/>
  <button type="submit">ê²€ìƒ‰</button>
  <button type="button" onclick="resetSearch()">ì´ˆê¸°í™”</button>
</form>
<br>

<!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ì„ ë•Œ -->
<p th:if="${#lists.isEmpty(videoPage.content)}">
  <span th:if="${not #strings.isEmpty(param.keyword)}">
    "<span th:text="${param.keyword}"></span>"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
  </span>
  <span th:unless="${not #strings.isEmpty(param.keyword)}">
    ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.
  </span>
</p>

<!-- ê²°ê³¼ê°€ ìˆì„ ë•Œ í…Œì´ë¸” ì¶œë ¥ -->
<table border="1" th:if="${not #lists.isEmpty(videoPage.content)}">
  <thead>
  <tr>
    <th>ë²ˆí˜¸</th>
    <th>ì œëª©</th>
    <th>ì„¤ëª…</th>
    <th>íŒŒì¼ëª…</th>
    <th>ë“±ë¡ì¼</th>
    <th>ìˆ˜ì •ì¼</th>
    <th>ê´€ë¦¬</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="video, stat : ${videoPage.content}"
      th:id="'row-' + ${video.videoId}"
      th:data-id="${video.videoId}"
      class="clickable-row"
      style="cursor:pointer;">
    <td th:text="${videoPage.number * videoPage.size + stat.index + 1}">1</td>
    <td th:text="${video.title}">ì œëª©</td>
    <td th:text="${video.content}">ì„¤ëª…</td>
    <td th:text="${video.videoName}">íŒŒì¼ëª…</td>
    <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd')}">ë“±ë¡ì¼</td>
    <td th:text="${video.updateDate != null ? #temporals.format(video.updateDate, 'yyyy-MM-dd') : ''}">ìˆ˜ì •ì¼</td>
    <td>
      <a th:href="@{/video/admin/sujung/{id}(id=${video.videoId}, page=${videoPage.number}, searchType=${searchType}, keyword=${keyword})}"
         onclick="event.stopPropagation();">ìˆ˜ì •</a>

      <button type="button"
              th:attr="data-id=${video.videoId}"
              onclick="event.stopPropagation(); deleteVideo(this);">ì‚­ì œ</button>
    </td>
  </tr>
  </tbody>
</table>

<div class="pagination" th:if="${videoPage.totalPages > 1}">
  <!-- ì´ì „ ë²„íŠ¼ -->
  <a th:if="${videoPage.number > 0}"
     th:href="@{/video/admin/list(page=${videoPage.number - 1}, searchType=${searchType}, keyword=${keyword})}">
    ì´ì „
  </a>
  <span th:unless="${videoPage.number > 0}">ì´ì „</span>

  <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
  <span th:each="i : ${#numbers.sequence(0, videoPage.totalPages - 1)}">
    <a th:href="@{/video/admin/list(page=${i}, searchType=${searchType}, keyword=${keyword})}"
       th:classappend="${i == videoPage.number} ? 'active' : ''"
       th:text="${i + 1}">1</a>
  </span>

  <!-- ë‹¤ìŒ ë²„íŠ¼ -->
  <a th:if="${videoPage.number + 1 < videoPage.totalPages}"
     th:href="@{/video/admin/list(page=${videoPage.number + 1}, searchType=${searchType}, keyword=${keyword})}">
    ë‹¤ìŒ
  </a>
  <span th:unless="${videoPage.number + 1 < videoPage.totalPages}">ë‹¤ìŒ</span>
</div>



<!-- âœ… Ajax ì‚­ì œìš© ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  function resetSearch() {
     document.getElementById('searchType').value = 'title';  // ê¸°ë³¸ ê²€ìƒ‰ì¡°ê±´
     document.getElementById('keyword').value = '';
     document.getElementById('searchForm').submit(); // ì´ˆê¸°í™” í›„ ë°”ë¡œ ì¬ê²€ìƒ‰
   }

  function deleteVideo(button) {
     const videoId = $(button).data("id");
     if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
         $.ajax({
             url: "/video/admin/" + videoId,
             type: "DELETE",
             success: function (result) {
                 alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                 $("#row-" + videoId).remove(); // DOMì—ì„œ í•´ë‹¹ í–‰ ì œê±°
             },
             error: function (xhr) {
                 const message = xhr.responseText || "ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                 alert(message);
             }
         });
     }
  }

  // tr í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (ìˆ˜ì •, ì‚­ì œ í´ë¦­ ì œì™¸)
  $(document).ready(function() {
   $(".clickable-row").click(function(e) {
     // í´ë¦­í•œ íƒœê·¸ê°€ ìˆ˜ì •/ì‚­ì œ/ì•„ì´ì½˜ì´ë©´ ì´ë™ ë§‰ê¸°
     if ($(e.target).closest("a, button").length === 0) {
       const videoId = $(this).data("id");
       if (videoId) {
         window.location.href = "/video/admin/view/" + videoId;
       }
     }
   });
  });


</script>
<!-- í‘¸í„° í”„ë˜ê·¸ë¨¼íŠ¸ ì‚½ì… -->
<div th:replace="~{fragments/footer :: footerFragment}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
