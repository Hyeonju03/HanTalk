<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관리자 영상 목록</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Tailwind CSS 메인 컬러 설정 */
    :root {
      --color-dark-navy: #2F4160;
      --color-coral-pink: #F29DA0;
      --color-soft-sky: #B5D0E3;
    }
    .bg-dark-navy { background-color: var(--color-dark-navy); }
    .text-dark-navy { color: var(--color-dark-navy); }
    .bg-coral-pink { background-color: var(--color-coral-pink); }
    .text-coral-pink { color: var(--color-coral-pink); }
    .bg-soft-sky { background-color: var(--color-soft-sky); }
    .text-soft-sky { color: var(--color-soft-sky); }

    /* 추가: 클릭 가능한 셀에만 커서 포인터 적용 */
    .clickable-cell {
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans flex flex-col min-h-screen">

<!-- 헤더 프래그먼트 삽입 -->
<div th:replace="~{fragments/header :: headerFragment}"></div>

<!-- 전체 페이지 컨테이너 -->
<div class="container mx-auto p-4 max-w-7xl flex-1">

  <!-- 모든 내용을 담는 흰색 배경 컨테이너 -->
  <div class="bg-white p-6 rounded-lg shadow-md">

    <!-- 관리자 페이지 제목 및 버튼 -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-dark-navy">관리자 영상 목록</h1>
      <a th:href="@{/admin}"
         class="inline-block bg-gray-700 text-gray-200 px-4 py-2 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200">
        관리자 페이지 <i class="fas fa-arrow-right ml-2"></i>
      </a>
    </div>

    <div class="flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0 mb-6">
      <!-- 새 영상 등록 버튼 -->
      <a th:href="@{/video/admin/chuga}"
         class="inline-block bg-dark-navy text-white px-4 py-2 rounded-lg shadow-md hover:bg-opacity-90 transition-colors duration-200">
        ➕ 새 영상 등록
      </a>

      <!-- 검색 폼 그룹 -->
      <form method="get" th:action="@{/video/admin/list}" id="searchForm" class="flex flex-wrap items-center space-x-2">
        <select name="searchType" id="searchType"
                class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-soft-sky focus:border-soft-sky">
          <option value="title" th:selected="${searchType == 'title'}">제목</option>
          <option value="content" th:selected="${searchType == 'content'}">내용</option>
          <option value="filename" th:selected="${searchType == 'filename'}">파일명</option>
          <option value="all" th:selected="${searchType == 'all'}">제목 + 내용 + 파일명</option>
        </select>
        <input type="text" name="keyword" placeholder="검색어를 입력해주세요" th:value="${keyword}" id="keyword"
               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-soft-sky focus:border-soft-sky min-w-40"/>
        <button type="submit" class="bg-dark-navy text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-colors duration-200">
          검색
        </button>
        <button type="button" onclick="resetSearch()"
                class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors duration-200">
          초기화
        </button>
      </form>
    </div>

    <!-- 검색 결과 없을 때 -->
    <div th:if="${#lists.isEmpty(videoPage.content)}" class="p-6 rounded-lg text-center text-gray-500">
        <span th:if="${not #strings.isEmpty(param.keyword)}">
            "<span th:text="${param.keyword}"></span>"에 대한 검색 결과가 없습니다.
        </span>
      <span th:unless="${not #strings.isEmpty(param.keyword)}">
            등록된 영상이 없습니다.
        </span>
    </div>

    <!-- 결과가 있을 때 테이블 출력 -->
    <div th:if="${not #lists.isEmpty(videoPage.content)}" class="rounded-lg shadow-md overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 table-fixed">
        <thead class="bg-gray-200 text-gray-800">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap w-12">번호</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap">제목</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap">설명</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap">파일명</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap w-24">등록일</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap w-24">수정일</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider whitespace-nowrap w-36">관리</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        <tr th:each="video, stat : ${videoPage.content}"
            th:id="'row-' + ${video.videoId}"
            th:data-id="${video.videoId}"
            class="hover:bg-gray-50 transition-colors duration-150">
          <td th:text="${videoPage.number * videoPage.size + stat.index + 1}" class="clickable-cell px-6 py-4 text-sm text-gray-900 whitespace-nowrap">1</td>
          <td class="clickable-cell px-6 py-4 text-sm font-medium text-gray-900 overflow-hidden" th:title="${video.title}">
            <div th:text="${video.title}" class="truncate w-full">제목</div>
          </td>
          <td class="clickable-cell px-6 py-4 text-sm text-gray-500 overflow-hidden" th:title="${video.content}">
            <div th:text="${video.content}" class="truncate w-full">설명</div>
          </td>
          <td class="clickable-cell px-6 py-4 text-sm text-gray-500 overflow-hidden" th:title="${video.videoName}">
            <div th:text="${video.videoName}" class="truncate w-full">파일명</div>
          </td>
          <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd')}" class="clickable-cell px-6 py-4 text-sm text-gray-500 whitespace-nowrap">등록일</td>
          <td th:text="${video.updateDate != null ? #temporals.format(video.updateDate, 'yyyy-MM-dd') : ''}" class="clickable-cell px-6 py-4 text-sm text-gray-500 whitespace-nowrap">수정일</td>
          <td class="px-6 py-4 text-sm font-medium whitespace-nowrap">
            <div class="flex space-x-2">
              <a th:href="@{/video/admin/sujung/{id}(id=${video.videoId}, page=${videoPage.number}, searchType=${searchType}, keyword=${keyword})}"
                 class="bg-dark-navy text-white px-3 py-1 rounded-lg hover:bg-gray-800 transition-all duration-300"
                 title="수정">
                <i class="fas fa-edit"></i> 수정
              </a>
              <!-- 삭제 버튼 -->
              <button type="button"
                      th:attr="onclick='deleteVideo(' + ${video.videoId} + ')'"
                      class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition-all duration-300"
                      title="삭제">
                <i class="fas fa-trash-alt"></i> 삭제
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- 페이지네이션 -->
    <div class="pagination flex justify-center items-center space-x-2 mt-6" th:if="${videoPage.totalPages > 1}">
      <a th:if="${videoPage.number > 0}" th:href="@{/video/admin/list(page=${videoPage.number - 1}, searchType=${searchType}, keyword=${keyword})}"
         class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-200 transition-colors duration-200">이전</a>
      <span th:unless="${videoPage.number > 0}" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-400 cursor-not-allowed">이전</span>
      <div class="flex space-x-1">
        <span th:each="i : ${#numbers.sequence(0, videoPage.totalPages - 1)}">
          <a th:href="@{/video/admin/list(page=${i}, searchType=${searchType}, keyword=${keyword})}"
             th:classappend="${i == videoPage.number} ? 'bg-dark-navy text-white' : 'text-gray-700 hover:bg-gray-200'"
             class="px-4 py-2 rounded-lg transition-colors duration-200" th:text="${i + 1}">1</a>
        </span>
      </div>
      <a th:if="${videoPage.number + 1 < videoPage.totalPages}" th:href="@{/video/admin/list(page=${videoPage.number + 1}, searchType=${searchType}, keyword=${keyword})}"
         class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-200 transition-colors duration-200">다음</a>
      <span th:unless="${videoPage.number + 1 < videoPage.totalPages}" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-400 cursor-not-allowed">다음</span>
    </div>

  </div>
</div>

<script>
  // 검색 폼 초기화
  function resetSearch() {
      document.getElementById('searchType').value = 'title';
      document.getElementById('keyword').value = '';
      document.getElementById('searchForm').submit();
  }

  // 행 클릭 시 상세페이지 이동
  document.querySelectorAll(".clickable-cell").forEach(cell => {
      cell.addEventListener('click', function() {
          const row = this.closest('tr');
          const videoId = row.getAttribute('data-id');
          if (videoId) {
              window.location.href = "/video/view/" + videoId;
          }
      });
  });

  // Ajax 삭제
 function deleteVideo(videoId) {
      if (!confirm("정말로 이 영상을 삭제하시겠습니까?")) return;

      fetch("/video/admin/" + videoId, {
          method: 'DELETE',
          headers: {'Content-Type': 'application/json'}
      })
      .then(res => {
          if (!res.ok) throw new Error("삭제 실패");
          return res.text();
      })
      .then(msg => {
          const row = document.getElementById('row-' + videoId);
          if (row) row.remove();
      })
      .catch(err => {
          alert(err);
          console.error(err);
      });
  }
</script>

<div th:replace="~{fragments/footer :: footerFragment}"></div>

</body>
</html>
