<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì ì˜ìƒ ëª©ë¡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <!-- Google Fonts for Nanum Gothic -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
    body {
        font-family: 'Nanum Gothic', sans-serif;
    }
    /* í…Œì´ë¸” í–‰ í´ë¦­ ì‹œ URL ì´ë™ì„ ìœ„í•œ ì»¤ì„œ ìŠ¤íƒ€ì¼ */
    .table-row-clickable {
        cursor: pointer;
    }
    /* í˜ì´ì§€ë„¤ì´ì…˜ í™œì„± ë²„íŠ¼ ìƒ‰ìƒ ì¡°ì • */
    .pagination a.active {
        background-color: #B5D0E3; /* ë¶€ë“œëŸ¬ìš´ í•˜ëŠ˜ìƒ‰ */
        color: white;
        border-radius: 0.5rem;
    }

    /* Custom animation for message box */
    @keyframes fadeOut {
        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
    }
  </style>
</head>
<body class="bg-[#f3f4f6] p-8 font-sans antialiased min-h-screen flex flex-col">

<!-- Thymeleaf fragments/header :: headerFragment ê°€ ì—†ìœ¼ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬ (HTML ë‹¨ë… ì‹¤í–‰ìš©) -->
<!-- <div th:replace="~{fragments/header :: headerFragment}"></div> -->

<div class="max-w-7xl mx-auto bg-white p-8 rounded-xl shadow-lg flex-grow">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-[#2F4160]">ê´€ë¦¬ì ì˜ìƒ ëª©ë¡</h1>
    <a th:href="@{/video/admin/chuga}"
       class="bg-[#4B4B4B] text-white font-medium py-2 px-6 rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300 flex items-center">
      <i class="fas fa-plus mr-2"></i> ìƒˆ ì˜ìƒ ë“±ë¡
    </a>
  </div>

  <!-- ğŸ” ê²€ìƒ‰ í¼ -->
  <form method="get" th:action="@{/video/admin/list}" id="searchForm"
        class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
    <select name="searchType" id="searchType"
            class="border border-gray-300 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
      <option value="title" th:selected="${searchType == 'title'}">ì œëª©</option>
      <option value="content" th:selected="${searchType == 'content'}">ë‚´ìš©</option>
      <option value="filename" th:selected="${searchType == 'filename'}">íŒŒì¼ëª…</option>
      <option value="all" th:selected="${searchType == 'all'}">ì œëª© + ë‚´ìš© + íŒŒì¼ëª…</option>
    </select>
    <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" th:value="${keyword}" id="keyword"
           class="flex-grow w-full sm:w-auto border border-gray-300 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]"/>
    <button type="submit"
            class="w-full sm:w-auto bg-[#4B4B4B] text-white py-2 px-6 rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300">
      <i class="fas fa-search mr-1"></i>ê²€ìƒ‰
    </button>
    <button type="button" onclick="resetSearch()"
            class="w-full sm:w-auto bg-gray-200 text-gray-700 py-2 px-6 rounded-lg shadow-md hover:bg-gray-300 transition-colors duration-300">
      <i class="fas fa-undo mr-1"></i>ì´ˆê¸°í™”
    </button>
  </form>

  <!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ì„ ë•Œ -->
  <p th:if="${#lists.isEmpty(videoPage.content)}" class="text-center py-12 text-gray-500">
      <span th:if="${not #strings.isEmpty(param.keyword)}">
        "<span th:text="${param.keyword}"></span>"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
      </span>
    <span th:unless="${not #strings.isEmpty(param.keyword)}">
        ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.
      </span>
  </p>

  <!-- ê²°ê³¼ê°€ ìˆì„ ë•Œ í…Œì´ë¸” ì¶œë ¥ -->
  <div class="overflow-x-auto" th:if="${not #lists.isEmpty(videoPage.content)}">
    <table class="min-w-full bg-white rounded-lg border-collapse shadow-lg">
      <thead>
      <tr class="bg-[#FDFBFF] text-[#2F4160] text-left text-sm font-semibold uppercase tracking-wider">
        <th class="py-3 px-4 rounded-tl-lg">ë²ˆí˜¸</th>
        <th class="py-3 px-4">ì œëª©</th>
        <th class="py-3 px-4">ì„¤ëª…</th>
        <th class="py-3 px-4">íŒŒì¼ëª…</th>
        <th class="py-3 px-4">ë“±ë¡ì¼</th>
        <th class="py-3 px-4">ìˆ˜ì •ì¼</th>
        <th class="py-3 px-4 rounded-tr-lg text-right">ê´€ë¦¬</th>
      </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
      <tr th:each="video, stat : ${videoPage.content}"
          th:id="'row-' + ${video.videoId}"
          th:data-id="${video.videoId}"
          class="clickable-row border-t border-gray-200 hover:bg-gray-50 transition-colors duration-300">
        <td th:text="${videoPage.number * videoPage.size + stat.index + 1}" class="px-6 py-4 whitespace-nowrap text-sm text-[#2F4160]">1</td>
        <td th:text="${video.title}" class="px-6 py-4 whitespace-nowrap text-sm font-medium text-[#2F4160]">ì œëª©</td>
        <td th:text="${video.content}" class="px-6 py-4 text-sm text-[#2F4160]">ì„¤ëª…</td>
        <td th:text="${video.videoName}" class="px-6 py-4 whitespace-nowrap text-sm text-[#2F4160]">íŒŒì¼ëª…</td>
        <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd')}" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">ë“±ë¡ì¼</td>
        <td th:text="${video.updateDate != null ? #temporals.format(video.updateDate, 'yyyy-MM-dd') : ''}" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">ìˆ˜ì •ì¼</td>
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <div class="flex justify-end items-center space-x-2">
            <a th:href="@{/video/admin/sujung/{id}(id=${video.videoId}, page=${videoPage.number}, searchType=${searchType}, keyword=${keyword})}"
               onclick="event.stopPropagation();"
               class="bg-[#4B4B4B] text-white font-semibold py-1 px-3 rounded-lg hover:bg-[#2F4160] transition duration-300">
              <i class="fas fa-edit mr-1"></i>ìˆ˜ì •
            </a>
            <button type="button"
                    class="bg-red-500 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-600 transition duration-300"
                    th:data-id="${video.videoId}">
              <i class="fas fa-trash"></i> ì‚­ì œ
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination mt-8 pb-8" th:if="${videoPage.totalPages > 1}">
    <ul class="flex justify-center items-center space-x-2">
      <!-- ì´ì „ ë¸”ë¡ ë²„íŠ¼ (Thymeleaf ë³€ìˆ˜ëª… ì¼ì¹˜) -->
      <li th:if="${videoPage.number > 0}">
        <a th:href="@{/video/admin/list(page=${videoPage.number - 1}, searchType=${searchType}, keyword=${keyword})}"
           class="flex items-center justify-center w-10 h-10 rounded-lg bg-white border border-gray-300 text-gray-600 hover:bg-gray-200 transition-colors duration-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </a>
      </li>

      <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
      <li th:each="i : ${#numbers.sequence(0, videoPage.totalPages - 1)}">
        <a th:href="@{/video/admin/list(page=${i}, searchType=${searchType}, keyword=${keyword})}"
           th:text="${i + 1}"
           th:classappend="${i == videoPage.number} ? 'bg-[#B5D0E3] text-white rounded-lg font-bold' : 'bg-white text-[#2F4160] rounded-lg hover:bg-gray-200'"
           class="flex items-center justify-center w-10 h-10 transition-colors duration-300">
        </a>
      </li>

      <!-- ë‹¤ìŒ ë¸”ë¡ ë²„íŠ¼ (Thymeleaf ë³€ìˆ˜ëª… ì¼ì¹˜) -->
      <li th:if="${videoPage.number + 1 < videoPage.totalPages}">
        <a th:href="@{/video/admin/list(page=${videoPage.number + 1}, searchType=${searchType}, keyword=${keyword})}"
           class="flex items-center justify-center w-10 h-10 rounded-lg bg-white border border-gray-300 text-gray-600 hover:bg-gray-200 transition-colors duration-300">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </a>
      </li>
    </ul>
  </div>

</div>

<!-- Custom message box and deletion script -->
<script>
  // Custom message box function (reused from other admin pages)
  function showCustomMessage(message, type = 'info') {
      const messageBox = document.createElement('div');
      messageBox.textContent = message;
      let bgColor = '#2F4160'; // Default: Dark Navy
      let textColor = 'white';

      if (type === 'error') {
          bgColor = '#F29DA0'; // Coral Pink for errors
      } else if (type === 'success') {
          bgColor = '#B5D0E3'; // Soft Sky Blue for success
          textColor = '#2F4160'; // Dark Navy for text on success
      }

      messageBox.style.cssText = `
          position: fixed;
          top: 20%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: ${bgColor};
          color: ${textColor};
          padding: 15px 30px;
          border-radius: 8px;
          z-index: 1000;
          font-size: 1.1em;
          box-shadow: 0 4px 10px rgba(0,0,0,0.2);
          animation: fadeOut 3s forwards;
      `;
      document.body.appendChild(messageBox);

      // Ensure the fadeOut keyframes are available (add only once)
      if (!document.querySelector('style#fadeOutKeyframes')) {
          const styleSheet = document.createElement("style");
          styleSheet.id = "fadeOutKeyframes"; // Add an ID to prevent duplicates
          styleSheet.type = "text/css";
          styleSheet.innerText = `
              @keyframes fadeOut {
                  0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
              }
          `;
          document.head.appendChild(styleSheet);
      }

      setTimeout(() => {
          messageBox.remove();
          // Do not remove styleSheet, as it might be used by other messages
      }, 3000);
  }

function resetSearch() {
   document.getElementById('searchType').value = 'title';  // ê¸°ë³¸ ê²€ìƒ‰ì¡°ê±´
   document.getElementById('keyword').value = '';
   document.getElementById('searchForm').submit(); // ì´ˆê¸°í™” í›„ ë°”ë¡œ ì¬ê²€ìƒ‰
 }

// Modified deleteVideo to use showCustomMessage
function deleteVideo(button) {
   const videoId = $(button).data("id");
   showCustomMessage('ì •ë§ ì´ ìë£Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ ë©”ì‹œì§€ëŠ” Canvas í™˜ê²½ì—ì„œëŠ” í™•ì¸ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚­ì œê°€ ì§„í–‰ë©ë‹ˆë‹¤.)', 'info');

   $.ajax({
       url: "/video/admin/" + videoId,
       type: "DELETE",
       success: function (result) {
           showCustomMessage("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
           $("#row-" + videoId).remove(); // DOMì—ì„œ í•´ë‹¹ í–‰ ì œê±°
       },
       error: function (xhr) {
           const message = xhr.responseText || "ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
           showCustomMessage(message, 'error');
       }
   });
}

// video/admin.html
// tr í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
$(document).ready(function() {
$(".clickable-row").click(function(e) {
  // Only proceed if the click target is NOT an anchor tag or a button
  if (!$(e.target).closest("a, button").length) {
    const videoId = $(this).data("id");
    if (videoId) {
      // URLì„ "/video/view/"ë¡œ í†µì¼
      window.location.href = "/video/view/" + videoId;
    }
  }
});

// Attach click event listener to delete buttons specifically
// Delegated event handling for dynamically added rows or if buttons are not present on initial load
$('body').on('click', '.bg-red-500.text-white', function(e) {
    e.stopPropagation(); // Prevent the row click event from firing
    deleteVideo(this);
});
});


</script>
<!-- í‘¸í„° í”„ë˜ê·¸ë¨¼íŠ¸ ì‚½ì… -->
<!-- <div th:replace="~{fragments/footer :: footerFragment}"></div> -->

<!-- Bootstrap JS (was in original, but not used by Tailwind, so keep only if needed elsewhere) -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->
</body>
</html>
