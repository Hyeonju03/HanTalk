<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì˜ìƒ ëª©ë¡ (ê´€ë¦¬ì)</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>ì˜ìƒ ëª©ë¡</h1>

<!-- ğŸ” ê²€ìƒ‰ í¼ -->
<form method="get" th:action="@{/admin/video/list}">
  <select name="searchType">
    <option value="title" th:selected="${searchType} == 'title'">ì œëª©</option>
    <option value="content" th:selected="${searchType} == 'content'">ë‚´ìš©</option>
    <option value="all" th:selected="${searchType} == 'all'">ì œëª© + ë‚´ìš©</option>
  </select>
  <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" th:value="${keyword}" />
  <button type="submit">ê²€ìƒ‰</button>
</form>

<!-- â• ìƒˆ ì˜ìƒ ë“±ë¡ -->
<a th:href="@{/admin/video/upload}">â• ìƒˆ ì˜ìƒ ë“±ë¡</a>

<table border="1">
  <thead>
  <tr>
    <th>ì œëª©</th>
    <th>ì„¤ëª…</th>
    <th>ë“±ë¡ì¼</th>
    <th>ìˆ˜ì •ì¼</th>
    <th>ê´€ë¦¬</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="video : ${videoPage.content}" th:id="'row-' + ${video.videoId}">
    <td>
      <a th:href="@{/admin/video/view/{id}(id=${video.videoId})}"
         th:text="${video.title}">ì œëª©</a>
    </td>
    <td th:text="${video.content}">ë‚´ìš©</td>
    <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd')}">ë“±ë¡ì¼</td>
    <td th:text="${video.updateDate != null ? #temporals.format(video.updateDate, 'yyyy-MM-dd') : ''}">ìˆ˜ì •ì¼</td>
    <td>
      <a th:href="@{/admin/video/edit/{id}(id=${video.videoId})}">ìˆ˜ì •</a> |
      <button type="button"
              th:attr="data-id=${video.videoId}"
              onclick="deleteVideo(this)">ì‚­ì œ</button>
    </td>
  </tr>
  </tbody>
</table>

  <div class="pagination" th:if="${videoPage.totalPages > 1}">
  <span th:each="i : ${#numbers.sequence(0, videoPage.totalPages - 1)}">
    <a th:href="@{'/' + ${role} + '/video/list'(page=${i})}"
       th:classappend="${i == videoPage.number} ? 'active' : ''"
       th:text="${i + 1}">1</a>
  </span>
  </div>

<!-- âœ… Ajax ì‚­ì œìš© ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  function deleteVideo(button) {
      const videoId = $(button).data("id");
      if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          $.ajax({
              url: "/admin/video/" + videoId,
              type: "DELETE",
              success: function (result) {
                  alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                  $("#row-" + videoId).remove(); // DOMì—ì„œ í•´ë‹¹ í–‰ ì œê±°
              },
              error: function (xhr) {
                  const message = xhr.responseText || "ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                  alert(message);
              }
          });
      }
  }
</script>
</body>
</html>
