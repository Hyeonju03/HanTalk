<!--<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>영상 목록</title>
</head>
<body>
<h1>영상 목록</h1>
<a th:href="@{/video/upload}">➕ 새 영상 등록</a>
<table border="1">
    <thead>
    <tr>
        <th>번호</th>
        <th>제목</th>
        <th>등록일</th>
        <th>재생</th>
        <th>수정</th>
        <th>삭제</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="video : ${videos}">
        <td th:text="${video.videoId}"></td>
        <td th:text="${video.title}"></td>
        <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd HH:mm')}"></td>
        <td>
            <video width="200" controls th:src="@{'/upload/' + ${video.videoName}}"></video>
        </td>
        <td><a th:href="@{/video/edit/{id}(id=${video.videoId})}">수정</a></td>
        <td><a th:href="@{/video/delete/{id}(id=${video.videoId})}" onclick="return confirm('삭제할까요?');">삭제</a></td>
    </tr>
    </tbody>
</table>
</body>
</html>-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>영상 목록</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>영상 목록</h1>

<!-- 🔍 검색 폼 -->
<form method="get" action="/video/list">
    <select name="searchType">
        <option value="title" th:selected="${searchType} == 'title'">제목</option>
        <option value="content" th:selected="${searchType} == 'content'">내용</option>
        <option value="all" th:selected="${searchType} == 'all'">제목 + 내용</option>
    </select>

    <input type="text" name="keyword" placeholder="검색어를 입력해주세요" th:value="${keyword}" />
    <button type="submit">검색</button>
</form>


<a href="/video/upload">➕ 새 영상 등록</a>

<table border="1">
    <thead>
    <tr>
        <th>제목</th>
        <th>설명</th>
        <th>등록일</th>
        <th>수정일</th>
        <th>관리</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="video : ${videos}" th:id="'row-' + ${video.videoId}">
        <td>
            <a th:href="@{/video/view/{id}(id=${video.videoId})}"
               th:text="${video.title}">제목</a>
        </td>
        <td th:text="${video.content}">내용</td>
        <td th:text="${#temporals.format(video.createDate, 'yyyy-MM-dd')}">등록일</td>
        <td th:text="${video.updateDate != null ? #temporals.format(video.updateDate, 'yyyy-MM-dd') : ''}">수정일</td>
        <td>
            <a th:href="@{/video/edit/{id}(id=${video.videoId})}">수정</a> |
            <button type="button"
                    th:attr="data-id=${video.videoId}"
                    onclick="deleteVideo(this)">삭제</button>
        </td>
    </tr>
    </tbody>
</table>

<script>
    function deleteVideo(button) {
        const videoId = $(button).data("id");
        if (confirm("정말 삭제하시겠습니까?")) {
            $.ajax({
                url: "/video/" + videoId,
                type: "DELETE",
                success: function () {
                    alert("삭제되었습니다.");
                    $("#row-" + videoId).remove(); // DOM에서 행 제거
                },
                error: function () {
                    alert("삭제 중 오류가 발생했습니다.");
                }
            });
        }
    }
</script>
</body>
</html>
