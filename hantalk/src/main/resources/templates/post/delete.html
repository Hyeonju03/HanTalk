<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시물 삭제</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

<div class="bg-white p-8 rounded-lg shadow-md w-full max-w-lg text-center">
  <h2 class="text-2xl font-bold mb-4 text-red-600">게시물 삭제</h2>
  <p class="mb-6 text-gray-700">정말로 이 게시물을 삭제하시겠습니까?</p>

  <div class="mb-6">
    <span class="font-semibold text-gray-800">제목:</span>
    <span class="text-gray-600" th:text="${post.title}">게시물 제목이 여기에 표시됩니다.</span>
  </div>

  <div class="flex justify-center space-x-4">
    <button id="deleteButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
      삭제
    </button>
    <a th:href="@{/post/view/{postId}(postId=${post.postId})}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
      취소
    </a>
  </div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  const postId = [[${post.postId}]];
  const deleteButton = document.getElementById('deleteButton');

  if (deleteButton) {
      deleteButton.addEventListener('click', function() {
          if (confirm('삭제된 게시물은 복구할 수 없습니다. 계속하시겠습니까?')) {
              fetch('/post/deleteProc/' + postId, {
                  method: 'DELETE',
                  headers: {
                      'Content-Type': 'application/json'
                  }
              })
              .then(response => {
                  if (response.ok) {
                      alert('게시물이 성공적으로 삭제되었습니다.');
                      window.location.href = '/post/list/' + [[${post.category.categoryId}]]; // 카테고리 목록으로 이동
                  } else if (response.status === 401) {
                      alert('로그인이 필요합니다.');
                      window.location.href = '/user/login';
                  } else if (response.status === 403) {
                      alert('삭제 권한이 없습니다.');
                  } else {
                      alert('삭제에 실패했습니다.');
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('삭제 중 오류가 발생했습니다.');
              });
          }
      });
  }
  /*]]>*/
</script>

</body>
</html>