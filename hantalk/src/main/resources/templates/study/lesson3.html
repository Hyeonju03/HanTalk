<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>4지선다 객관식 학습</title>
    <script th:inline="javascript">
        // 서버에서 전달된 문제 데이터
        let questions = /*[[${questions}]]*/ [];  // description, options, answer 포함
        let answers = new Array(questions.length).fill(""); // 사용자 선택 저장
        let currentIndex = 0;

        // 페이지 로드 시 첫 문제 표시
        window.onload = function() {
            showQuestion(currentIndex);
        };

        // 현재 문제 표시
        function showQuestion(index) {
            const question = questions[index];

            // 문제 설명 표시
            document.getElementById('description').textContent = question['description'];

            // 보기 표시
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = "";
            question['options'].forEach(option => {
                const optionHtml = `
                    <label>
                        <input type="radio" name="option" value="${option}"
                            ${answers[index] === option ? 'checked' : ''}>
                        ${option}
                    </label><br>`;
                optionsContainer.innerHTML += optionHtml;
            });

            // 마지막 문제면 버튼 문구 변경
            document.getElementById('nextBtn').textContent =
                (index === questions.length - 1) ? "결과 보기" : "다음으로";
        }

        // 다음 문제로 이동하거나 결과 표시
        function nextQuestion() {
            // 현재 선택 저장
            const selected = document.querySelector('input[name="option"]:checked');
            answers[currentIndex] = selected ? selected.value : "";

            if (currentIndex === questions.length - 1) {
                showResult();
            } else {
                currentIndex++;
                showQuestion(currentIndex);
            }
        }

        // 최종 결과 표시
        function showResult() {
            let output = "";
            for (let i = 0; i < questions.length; i++) {
                let correct = questions[i].answer; // 정답
                let userAnswer = answers[i];
                if (userAnswer === correct) {
                    output += `<p>${i + 1}번: 정답! (${correct})</p>`;
                } else {
                    output += `<p>${i + 1}번: 오답 (정답은 ${correct})</p>`;
                }
            }

            // 결과 화면 표시
            document.body.innerHTML = `
                <h1>결과</h1>
                ${output}
            `;

            // 학습 완료 로그 저장 호출 (lesson3 → complete3)
            fetch('/study/complete3', {
                method: 'POST'
            })
            .then(res => res.text())
            .then(result => {
                if (result === 'success') {
                    console.log("학습 로그 저장 성공 (lesson3)");
                } else {
                    console.log("로그 저장 실패 (lesson3)");
                }
            });
        }
    </script>
</head>
<body>
<h1>학습 3 - 4지선다 객관식</h1>

<p id="description"></p>
<div id="options"></div>
<button type="button" id="nextBtn" onclick="nextQuestion()">다음으로</button>
<p id="result"></p>
</body>
</html>
