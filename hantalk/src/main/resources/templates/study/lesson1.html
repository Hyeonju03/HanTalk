<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‹¨ì–´ ë§ì¶”ê¸°</title>

    <!-- Bootstrapì€ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì œê±°í•˜ê³  Tailwind CSSë§Œ ë‚¨ê¹€ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script th:inline="javascript">
        let problems = /*[[${problems}]]*/ [];
        let answered = false;

        window.onload = function () {
            // ë¬¸ì œê°€ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
            if (problems.length > 0) {
                showProblem(problems[0]);
            } else {
                document.getElementById('description').textContent = "";
                document.getElementById('completion-message').textContent = "ë” ì´ìƒ í’€ ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ë¬¸ì œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆì–´ìš”!";
            }
        };

        function showProblem(problem) {
            document.getElementById('description').textContent = problem.description;
            document.getElementById('answer').value = "";
            document.getElementById('result').textContent = "";
            document.getElementById('feedback-icon').classList.add('hidden'); // í”¼ë“œë°± ì•„ì´ì½˜ ìˆ¨ê¸°ê¸°
            answered = false; // ì •ë‹µ ì œì¶œ ì—¬ë¶€ ì´ˆê¸°í™”
        }

        function submitAnswer() {
            // ì´ë¯¸ ì •ë‹µì„ ì œì¶œí–ˆë‹¤ë©´ ë‹¤ì‹œ ì œì¶œí•˜ì§€ ì•Šë„ë¡ ë°©ì§€
            if (answered) return;

            const problem = problems[0]; // í˜„ì¬ í’€ ë¬¸ì œ
            const userAnswer = document.getElementById('answer').value.trim(); // ì‚¬ìš©ì ì…ë ¥ ê°’
            const correctAnswer = problem.vocabulary; // ì •ë‹µ ë‹¨ì–´
            const vocaId = problem.vocaId; // ë‹¨ì–´ ID
            const isCorrect = userAnswer === correctAnswer; // ì •ë‹µ ì—¬ë¶€ í™•ì¸

            // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ (ì •ë‹µ/ì˜¤ë‹µê³¼ ì •ë‹µ ë‹¨ì–´)
            document.getElementById('result').textContent = isCorrect
                ? `ì •ë‹µì´ì—ìš”! (${correctAnswer})`
                : `ì•„ì‰½ë„¤ìš”! ì •ë‹µì€ ${correctAnswer} ì´ì—ˆì–´ìš”.`;
            showFeedback(isCorrect); // O ë˜ëŠ” X ì•„ì´ì½˜ í‘œì‹œ

            // ë°±ì—”ë“œë¡œ ì •ë‹µ ì—¬ë¶€ ì „ì†¡ (fetch API ì‚¬ìš©)
            fetch('/study/lesson1/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({
                    vocaId: vocaId,
                    answer: userAnswer,
                    correctAnswer: correctAnswer
                })
            })
            .then(res => res.json())
            .then(result => console.log("ì •ë‹µ ì—¬ë¶€:", result))
            .catch(err => console.error("ì •ë‹µ ì²´í¬ ì˜¤ë¥˜:", err));

            answered = true; // ì •ë‹µ ì œì¶œ ìƒíƒœë¡œ ë³€ê²½
        }

    function showFeedback(isCorrect) {
      const container = document.getElementById('feedback-icon');
      container.classList.remove('hidden');

      // ì»¨í…Œì´ë„ˆëŠ” ì¤‘ì•™ì •ë ¬ë§Œ ë‹´ë‹¹, ì• ë‹ˆë©”ì´ì…˜ì€ ì•ˆìª½ spanì—ì„œë§Œ ìˆ˜í–‰
      const symbol = isCorrect ? 'âœ”ï¸' : 'âŒ';
      const color  = isCorrect ? '#2F4160' : '#F29DA0';
      const anim   = isCorrect ? 'animate-pulse' : 'animate-bounce';

      container.innerHTML = `
        <span class="${anim} text-9xl font-extrabold drop-shadow"
              style="color:${color}">
          ${symbol}
        </span>
      `;

      // 1.5ì´ˆ í›„ ìˆ¨ê¹€
      setTimeout(() => {
          container.classList.add('hidden');
          container.innerHTML = '';
      }, 1500);
  }

        function nextProblem() {
            // ì •ë‹µì„ ì œì¶œí•˜ì§€ ì•Šì•˜ë‹¤ë©´ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ìŒ
            if (!answered) {
                // ì»¤ìŠ¤í…€ ëª¨ë‹¬ ë˜ëŠ” ì‹œê°ì  í”¼ë“œë°±ìœ¼ë¡œ ë³€ê²½ (alert ëŒ€ì‹ )
                const messageBox = document.createElement('div');
                messageBox.textContent = "ë¨¼ì € ì •ë‹µì„ ì œì¶œí•´ì£¼ì„¸ìš”!";
                messageBox.style.cssText = `
                    position: fixed;
                    top: 20%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #2F4160; /* ì§„í•œ ë‚¨ìƒ‰ */
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    z-index: 1000;
                    font-size: 1.1em;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                    animation: fadeOut 3s forwards; /* 3ì´ˆ í›„ ì‚¬ë¼ì§€ë„ë¡ ì• ë‹ˆë©”ì´ì…˜ ì ìš© */
                `;
                document.body.appendChild(messageBox);

                // CSS ì• ë‹ˆë©”ì´ì…˜ ì •ì˜
                const styleSheet = document.createElement("style");
                styleSheet.type = "text/css";
                styleSheet.innerText = `
                    @keyframes fadeOut {
                        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                    }
                `;
                document.head.appendChild(styleSheet);

                setTimeout(() => {
                    messageBox.remove();
                    styleSheet.remove();
                }, 3000); // 3ì´ˆ í›„ ë©”ì‹œì§€ ë°•ìŠ¤ ì œê±°
                return;
            }
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ ë¡œë“œ
        }

        function quitLesson() {
            // window.openerê°€ ìˆë‹¤ë©´ (íŒì—… ì°½ìœ¼ë¡œ ì—´ë ¸ë‹¤ë©´) ì°½ ë‹«ê¸°
            if (window.opener) {
                window.close();
            } else {
                // ì§ì ‘ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ë ¸ë‹¤ë©´ ë©”ì‹œì§€ í‘œì‹œ (alert ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬)
                const messageBox = document.createElement('div');
                messageBox.textContent = "ì´ ì°½ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ë ¸ê¸° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ ë‹«ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                messageBox.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #2F4160; /* ì§„í•œ ë‚¨ìƒ‰ */
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    z-index: 1000;
                    font-size: 1.2em;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                `;
                document.body.appendChild(messageBox);

                // 3ì´ˆ í›„ ë©”ì‹œì§€ ë°•ìŠ¤ ì œê±°
                setTimeout(() => {
                    messageBox.remove();
                }, 3000);
            }
        }
    </script>
    <style>
        /* Nanum Gothic í°íŠ¸ ì„¤ì • (CDN ëŒ€ì‹  Google Fonts ì§ì ‘ ì„í¬íŠ¸) */
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
        body {
            font-family: 'Nanum Gothic', sans-serif;
        }
    </style>
</head>
<body class="bg-[#FBF9F2] min-h-screen flex flex-col items-center p-4">

<h1 class="text-4xl font-extrabold text-[#2F4160] mb-8 mt-12">ğŸ“ ë‹¨ì–´ ë§ì¶”ê¸° í•™ìŠµ</h1>

<div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-lg flex flex-col items-center space-y-6">
    <p id="description" class="text-xl text-[#2F4160] font-semibold text-center leading-relaxed"></p>
    <input type="text" id="answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"
           class="border-2 border-[#B5D0E3] rounded-lg px-4 py-3 w-full text-lg focus:outline-none focus:ring-4 focus:ring-[#F29DA0] transition duration-300 placeholder-gray-400">

    <div class="flex gap-4">
        <button onclick="submitAnswer()"
                class="bg-[#F29DA0] text-white px-8 py-3 rounded-xl font-bold text-lg hover:bg-[#2F4160] transition duration-300 transform hover:scale-105 shadow-md">
            ì œì¶œí•˜ê¸°
        </button>
        <button onclick="nextProblem()"
                class="bg-[#B5D0E3] text-[#2F4160] px-8 py-3 rounded-xl font-bold text-lg hover:bg-[#2F4160] hover:text-white transition duration-300 transform hover:scale-105 shadow-md">
            ë‹¤ìŒ ë¬¸ì œ
        </button>
    </div>

    <p id="result" class="text-xl font-bold mt-4"></p>
    <p id="completion-message" class="text-2xl font-extrabold text-[#2F4160] mt-24 text-center"></p>
</div>


<div id="feedback-icon" class="hidden fixed inset-0 z-[9999] pointer-events-none flex items-center justify-center"></div>


<!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ -->
<div class="fixed bottom-6 right-6">
    <button onclick="quitLesson()"
            class="bg-gray-500 text-white px-6 py-3 rounded-xl font-bold text-lg hover:bg-gray-700 transition duration-300 transform hover:scale-105 shadow-lg">
        ê·¸ë§Œ í•˜ê¸°
    </button>
</div>

</body>
</html>
