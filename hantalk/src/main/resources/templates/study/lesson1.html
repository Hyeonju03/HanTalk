<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>단어 맞추기</title>

    <!-- Bootstrap과 Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <script th:inline="javascript">
        let problems = /*[[${problems}]]*/ [];
        let answered = false;

        window.onload = function () {
            if (problems.length > 0) {
                showProblem(problems[0]);
            } else {
                document.getElementById('description').textContent = "";
                document.getElementById('completion-message').textContent = "더 이상 풀 문제는 없습니다.";
            }
        };

        function showProblem(problem) {
            document.getElementById('description').textContent = problem.description;
            document.getElementById('answer').value = "";
            document.getElementById('result').textContent = "";
            document.getElementById('feedback-icon').classList.add('hidden');
            answered = false;
        }

        function submitAnswer() {
            if (answered) return;

            const problem = problems[0];
            const userAnswer = document.getElementById('answer').value.trim();
            const correctAnswer = problem.vocabulary;
            const vocaId = problem.vocaId;
            const isCorrect = userAnswer === correctAnswer;

            document.getElementById('result').textContent = isCorrect
                ? `정답! (${correctAnswer})`
                : `오답! 정답은 ${correctAnswer}`;
            showFeedback(isCorrect);

            fetch('/study/lesson1/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({
                    vocaId: vocaId,
                    answer: userAnswer,
                    correctAnswer: correctAnswer
                })
            })
            .then(res => res.json())
            .then(result => console.log("정답 여부:", result))
            .catch(err => console.error("정답 체크 오류:", err));

            answered = true;
        }

        function showFeedback(isCorrect) {
            const icon = document.getElementById('feedback-icon');
            icon.textContent = isCorrect ? 'O' : 'X';
            icon.className = isCorrect
                ? 'text-green-500 text-9xl fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2'
                : 'text-red-500 text-9xl fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2';
            icon.classList.remove('hidden');
        }

        function nextProblem() {
            if (!answered) {
                alert("먼저 정답을 제출하세요.");
                return;
            }
            location.reload();
        }

        function quitLesson() {
            if (window.opener) {
                window.close();
            } else {
                alert("이 창은 브라우저에서 직접 열렸기 때문에 자동으로 닫을 수 없습니다.");
            }
        }
    </script>
</head>
<body class="bg-blue-50 min-h-screen flex flex-col items-center p-4">

<h1 class="text-3xl font-bold text-blue-800 mb-6">단어 맞추기 학습</h1>

<p id="description" class="text-lg text-gray-700 mb-4"></p>
<input type="text" id="answer" placeholder="정답 입력" class="border border-gray-300 rounded px-3 py-2 mb-4 w-72 focus:outline-none focus:ring-2 focus:ring-blue-400">

<div class="flex gap-2 mb-4">
    <button onclick="submitAnswer()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">제출</button>
    <button onclick="nextProblem()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">다음으로</button>
</div>

<p id="result" class="text-lg font-medium mb-4"></p>
<p id="completion-message" class="text-xl font-bold text-blue-600 mt-24 text-center"></p>

<div id="feedback-icon" class="hidden"></div>

<!-- 하단 고정 버튼 -->
<div class="fixed bottom-4 right-4">
    <button onclick="quitLesson()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">그만하기</button>
</div>

</body>
</html>
