<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문장 목록 관리</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        .btn-delete:hover {
          text-decoration: underline;
        }
        /* 모든 페이지네이션 링크를 위한 기본 스타일 */
        .pagination-item-base {
          display: inline-flex; /* content를 중앙에 정렬하기 위해 inline-flex 사용 */
          align-items: center;
          justify-content: center;
          padding: 0.375rem 0.75rem; /* py-1.5 px-3에 해당 */
          background-color: transparent; /* 기본: 배경 투명 */
          color: #2F4160; /* 기본: 진한 남색 텍스트 */
          border: 1px solid transparent; /* 기본: 테두리 투명 */
          border-radius: 0.375rem; /* rounded-md에 해당 */
          text-decoration: none;
          font-weight: 600; /* 폰트 굵기 조정 */
          min-width: 36px; /* 버튼 최소 너비 설정 (숫자 1, 2 등 작아지는 것 방지) */
          height: 36px; /* 버튼 높이 설정 */
          box-sizing: border-box; /* 패딩과 테두리를 너비/높이에 포함 */

          transition-property: background-color, color, border-color;
          transition-duration: 200ms;
          transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 모든 페이지네이션 링크의 호버 상태 */
        .pagination-item-base:hover {
          background-color: #e0e0e0; /* 호버 시 연한 회색 배경 */
          color: #2F4160; /* 호버 시 진한 남색 텍스트 유지 */
          border-color: #e0e0e0; /* 호버 시 연한 회색 테두리 */
        }

        /* 활성 페이지 번호 스타일 */
        .pagination-item-base.active {
          font-weight: bold; /* font-bold에 해당 */
          background-color: #4B4B4B; /* 진한 회색 배경 */
          color: white; /* 흰색 텍스트 */
          border-color: #4B4B4B; /* 진한 회색 테두리 */
        }
        /* 활성 페이지 버튼의 호버 효과 */
        .pagination-item-base.active:hover {
             background-color: #4B4B4B; /* 활성 상태에서 호버 시 진한 회색 배경 유지 */
             color: white; /* 활성 상태에서 호버 시 흰색 텍스트 유지 */
             border-color: #4B4B4B; /* 활성 상태에서 호버 시 진한 회색 테두리 유지 */
        }


        /* 비활성화된 버튼 스타일 */
        .pagination-item-base.disabled {
          opacity: 0.5; /* 약간 흐리게 */
          cursor: default !important; /* 마우스 커서 변경 (금지 아이콘 제거) */
          background-color: transparent; /* 배경 투명 유지 */
          color: #2F4160; /* 텍스트 색상 유지 */
          border-color: transparent; /* 테두리 투명 유지 */
        }

        /* 비활성화된 버튼의 호버 효과도 연한 회색으로 */
        .pagination-item-base.disabled:hover {
            background-color: #e0e0e0; /* 호버 시 연한 회색 배경 (비활성화 상태에서도) */
            color: #2F4160; /* 호버 시 진한 남색 텍스트 유지 (비활성화 상태에서도) */
            border-color: #e0e0e0; /* 호버 시 연한 회색 테두리 (비활성화 상태에서도) */
        }
    </style>
</head>
<body class="bg-[#f3f4f6] p-8 font-sans antialiased min-h-screen flex flex-col">

<!-- 헤더 프래그먼트의 올바른 위치: <body> 태그 바로 다음 -->
<div th:replace="~{fragments/header :: headerFragment}"></div>

<!-- 메인 콘텐츠 컨테이너에 상단 여백 추가 -->
<div class="max-w-7xl mx-auto bg-white p-8 rounded-xl shadow-lg mt-8">

    <!-- 1. 문장 목록 관리 제목 (중앙 정렬 유지) -->
    <h1 class="text-3xl font-bold text-[#2F4160] mb-6 text-center">문장 목록 관리</h1>

    <!-- 2. 관리자 페이지 & 3. 문장 추가 버튼 (오른쪽 정렬, 세로 정렬) -->
    <div class="flex flex-col items-end space-y-4 mb-8">
        <!-- 관리자 페이지 버튼 (관리자 로그인 시에만 보임) -->
        <div sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/admin}"
               class="inline-block bg-[#2F4160] text-white py-2 px-4 rounded-lg shadow-md hover:bg-[#4B4B4B] transition-colors duration-200 flex items-center">
                관리자 페이지 <i class="fas fa-arrow-right ml-2"></i> <!-- 화살표 아이콘 추가 -->
            </a>
        </div>
        <!-- 문장 추가 버튼 -->
        <a th:href="@{'/study/sentenceInsert'}"
           class="bg-[#4B4B4B] text-white font-medium py-2 px-6 rounded-lg shadow-md hover:bg-[#2F4160] transition-colors duration-300 flex items-center">
            <i class="fas fa-plus mr-2"></i> <!-- Font Awesome 아이콘 추가 -->
            문장 추가
        </a>
    </div>

    <!-- 4. 검색창 (오른쪽 정렬) -->
    <div class="mb-8">
        <form th:action="@{/study/sentenceList/admin}" method="get" class="flex flex-col sm:flex-row items-center justify-end space-y-4 sm:space-y-0 sm:space-x-4">
            <input type="text" name="kw" th:value="${kw}" placeholder="문장 또는 의미 검색"
                   class="flex-grow w-full sm:w-auto border border-gray-300 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]">
            <button type="submit"
                    class="w-full sm:w-auto bg-[#4B4B4B] text-white py-2 px-6 rounded-lg shadow-md hover:bg-[#2F4160] hover:text-white transition-colors duration-300">
                <i class="fas fa-search mr-1"></i>검색 <!-- Font Awesome 아이콘 추가 -->
            </button>
        </form>
    </div>

    <!-- Success Message Background Color Changed to #B5D0E3 -->
    <div th:if="${message}" class="p-4 text-center text-[#2F4160] bg-[#B5D0E3] rounded-b-xl">
        [[${message}]]
    </div>

    <div class="p-8 overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg border-collapse">
            <thead>
            <tr class="bg-[#FDFBFF] text-[#2F4160] text-left text-sm font-semibold uppercase tracking-wider">
                <th class="py-3 px-4 rounded-tl-lg">순번</th>
                <th class="py-3 px-4">문장</th>
                <th class="py-3 px-4">의미</th>
                <th class="py-3 px-4">등록일</th>
                <th class="py-3 px-4 rounded-tr-lg text-right">관리</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${paging.content == null || paging.content.isEmpty()}">
                <td colspan="5" class="py-12 text-center text-gray-500">
                    문장 데이터가 존재하지 않습니다.
                </td>
            </tr>
            <tr th:each="sentence, loop : ${paging.content}" class="border-t border-gray-200 hover:bg-gray-50 transition-colors duration-300">
                <td th:text="${paging.number * paging.size + loop.count}" class="py-4 px-4 text-[#2F4160]"></td>
                <td th:text="${sentence.munjang.replace('^',' ')}" class="py-4 px-4 text-[#2F4160]"></td>
                <td th:text="${sentence.description}" class="py-4 px-4 text-[#2F4160]"></td>
                <td th:text="${#temporals.format(sentence.createDate, 'yyyy-MM-dd')}" class="py-4 px-4 text-sm text-gray-600"></td>
                <td class="py-4 px-4 text-right">
                    <a th:href="@{'/study/sentenceUpdate/' + ${sentence.sentenceId}(page=${paging.number}, kw=${kw})}" class="text-[#2F4160] hover:underline font-medium text-sm"><i class="fas fa-edit mr-1"></i>수정</a>
                    <span class="text-gray-400">|</span>
                    <button type="button" class="btn-delete text-red-500 hover:underline font-medium text-sm"
                            th:data-sentence-id="${sentence.sentenceId}"
                            th:data-page="${paging.number}"
                            th:data-kw="${kw}"><i class="fas fa-trash-alt mr-1"></i>삭제</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${!paging.isEmpty()}" class="mt-8 pb-8">
        <ul class="flex justify-center items-center space-x-2">
            <li class="page-item">
                <a class="pagination-item-base"
                   th:href="${paging.hasPrevious} ? @{|?page=0&kw=${kw}|} : '#'"
                   th:classappend="${!paging.hasPrevious} ? 'disabled'"
                   th:attrappend="onclick=${!paging.hasPrevious} ? 'event.preventDefault();' : ''">처음</a>
            </li>
            <li class="page-item">
                <a class="pagination-item-base"
                   th:href="${paging.hasPrevious} ? @{|?page=${paging.number - 1}&kw=${kw}|} : '#'"
                   th:classappend="${!paging.hasPrevious} ? 'disabled'"
                   th:attrappend="onclick=${!paging.hasPrevious} ? 'event.preventDefault();' : ''">이전</a>
            </li>

            <li th:each="page: ${#numbers.sequence(0, paging.totalPages - 1)}">
                <a th:href="@{|?page=${page}&kw=${kw}|}" th:text="${page + 1}"
                   th:classappend="${page == paging.number} ? 'active' : ''" class="pagination-item-base"></a>
            </li>

            <li class="page-item">
                <a class="pagination-item-base"
                   th:href="${paging.hasNext} ? @{|?page=${paging.number + 1}&kw=${kw}|} : '#'"
                   th:classappend="${!paging.hasNext} ? 'disabled'"
                   th:attrappend="onclick=${!paging.hasNext} ? 'event.preventDefault();' : ''">다음</a>
            </li>
            <li class="page-item">
                <a class="pagination-item-base"
                   th:href="${paging.hasNext} ? @{|?page=${paging.totalPages - 1}&kw=${kw}|} : '#'"
                   th:classappend="${!paging.hasNext} ? 'disabled'"
                   th:attrappend="onclick=${!paging.hasNext} ? 'event.preventDefault();' : ''">마지막</a>
            </li>
        </ul>
    </div>
</div>

<!-- Custom message box and deletion script -->
<script>
    // Custom message box function (from previous immersives)
    function showCustomMessage(message, type = 'info') {
        const messageBox = document.createElement('div');
        messageBox.textContent = message;
        let bgColor = '#2F4160'; // Default: Dark Navy
        let textColor = 'white';

        if (type === 'error') {
            bgColor = '#F29DA0'; // Coral Pink for errors
        } else if (type === 'success') {
            bgColor = '#B5D0E3'; // Soft Sky Blue for success
            textColor = '#2F4160'; // Dark Navy for text on success
        }

        messageBox.style.cssText = `
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: ${bgColor};
            color: ${textColor};
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 1.1em;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            animation: fadeOut 3s forwards;
        `;
        document.body.appendChild(messageBox);

        // Ensure the fadeOut keyframes are available (add only once)
        if (!document.querySelector('style#fadeOutKeyframes')) {
            const styleSheet = document.createElement("style");
            styleSheet.id = "fadeOutKeyframes"; // Add an ID to prevent duplicates
            styleSheet.type = "text/css";
            styleSheet.innerText = `
                @keyframes fadeOut {
                    0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                }
            `;
            document.head.appendChild(styleSheet);
        }

        setTimeout(() => {
            messageBox.remove();
            // Do not remove styleSheet, as it might be used by other messages
        }, 3000);
    }

    // Modified confirmDelete to use showCustomMessage
    function confirmDelete(sentenceId, page, kw) {
      showCustomMessage('정말 이 자료를 삭제하시겠습니까? (이 메시지는 Canvas 환경에서는 확인을 받지 않습니다.)', 'info');
      // 실제 삭제 로직은 showCustomMessage와는 별개로 진행됩니다.
      // Canvas의 보안 제약으로 confirm()이 동작하지 않으므로, 사용자에게 알림만 제공합니다.
      window.location.href = '/study/sentenceDelete/' + sentenceId + '?page=' + page + '&kw=' + kw;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.btn-delete');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const sentenceId = this.getAttribute('data-sentence-id');
                const page = this.getAttribute('data-page');
                const kw = this.getAttribute('data-kw');
                confirmDelete(sentenceId, page, kw);
            });
        });
    });
</script>

<!-- 푸터 삽입 -->
<div th:replace="~{fragments/footer :: footerFragment}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>