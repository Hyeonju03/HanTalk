<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관리자 자료실</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    /* 테이블 행 클릭 시 URL 이동을 위한 커서 스타일 */
    .table-row-clickable {
        cursor: pointer;
    }
    /* 페이지네이션 링크 스타일 (숫자 페이지 버튼용) */
    .pagination-item-base {
          display: inline-flex; /* content를 중앙에 정렬하기 위해 inline-flex 사용 */
          align-items: center;
          justify-content: center;
          padding: 0.375rem 0.75rem; /* py-1.5 px-3에 해당 */
          background-color: transparent; /* 기본: 배경 투명 */
          color: #2F4160; /* 기본: 진한 남색 텍스트 */
          border: 1px solid transparent; /* 기본: 테두리 투명 */
          border-radius: 0.375rem; /* rounded-md에 해당 */
          text-decoration: none;
          font-weight: 600; /* 폰트 굵기 조정 */
          min-width: 36px; /* 버튼 최소 너비 설정 (숫자 1, 2 등 작아지는 것 방지) */
          height: 36px; /* 버튼 높이 설정 */
          box-sizing: border-box; /* 패딩과 테두리를 너비/높이에 포함 */

          transition-property: background-color, color, border-color;
          transition-duration: 200ms;
          transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 모든 페이지네이션 링크의 호버 상태 */
        .pagination-item-base:hover {
          background-color: #e0e0e0; /* 호버 시 연한 회색 배경 */
          color: #2F4160; /* 호버 시 진한 남색 텍스트 유지 */
          border-color: #e0e0e0; /* 호버 시 연한 회색 테두리 */
        }

        /* 활성 페이지 번호 스타일 */
        .pagination-item-base.active {
          font-weight: bold; /* font-bold에 해당 */
          background-color: #4B4B4B; /* 진한 회색 배경 */
          color: white; /* 흰색 텍스트 */
          border-color: #4B4B4B; /* 진한 회색 테두리 */
        }
        /* 활성 페이지 버튼의 호버 효과 */
        .pagination-item-base.active:hover {
             background-color: #4B4B4B; /* 활성 상태에서 호버 시 진한 회색 배경 유지 */
             color: white; /* 활성 상태에서 호버 시 흰색 텍스트 유지 */
             border-color: #4B4B4B; /* 활성 상태에서 호버 시 진한 회색 테두리 유지 */
        }


        /* 비활성화된 버튼 스타일 */
        .pagination-item-base.disabled {
          opacity: 0.5; /* 약간 흐리게 */
          cursor: default !important; /* 마우스 커서 변경 (금지 아이콘 제거) */
          background-color: transparent; /* 배경 투명 유지 */
          color: #2F4160; /* 텍스트 색상 유지 */
          border-color: transparent; /* 테두리 투명 유지 */
        }

        /* 비활성화된 버튼의 호버 효과도 연한 회색으로 */
        .pagination-item-base.disabled:hover {
            background-color: #e0e0e0; /* 호버 시 연한 회색 배경 (비활성화 상태에서도) */
            color: #2F4160; /* 호버 시 진한 남색 텍스트 유지 (비활성화 상태에서도) */
            border-color: #e0e0e0; /* 호버 시 연한 회색 테두리 (비활성화 상태에서도) */
        }
  </style>
</head>
<body class="bg-[#f3f4f6] text-[#2F4160] min-h-screen flex flex-col">

<div th:replace="~{fragments/header :: headerFragment}"></div>

<div class="max-w-7xl w-full mx-auto bg-white p-8 rounded-xl shadow-lg mt-8">
  <h1 class="text-3xl font-bold text-[#2F4160] mb-6 text-center">자료실 목록</h1>

  <div class="flex flex-col items-end space-y-4 mb-8">
    <div>
      <a th:href="@{/admin}"
         class="inline-block bg-[#2F4160] text-white py-2 px-4 rounded-lg shadow-md hover:bg-[#4B4B4B] transition-colors duration-200">
        관리자 페이지<i class="fas fa-arrow-right ml-2"></i>
      </a>
    </div>
    <a th:href="@{/resource/chuga}"
       class="bg-[#4B4B4B] text-white font-semibold py-2 px-6 rounded-lg hover:bg-[#2F4160] transition duration-300 shadow-md flex items-center">
      <i class="fas fa-plus mr-2"></i>
      자료 등록하기
    </a>
  </div>

  <form class="search-form text-center mb-6 flex justify-center items-center space-x-2" th:action="@{/resource/admin/main}" method="get">
        <input type="text" name="keyword" placeholder="검색어 입력" th:value="${keyword} ?: ''"
               class="p-2 text-base w-[250px] border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#B5D0E3]" />
        <button type="submit"
                class="bg-[#4B4B4B] text-white py-2 px-6 rounded-lg hover:bg-[#2F4160] transition duration-300 ml-2">
          <i class="fas fa-search mr-1"></i>
          검색
        </button>
      </form>

  <table class="w-full border-collapse bg-gray-200 rounded-xl overflow-hidden shadow-md">
        <thead>
        <tr>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">번호</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">제목</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">내용</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">파일</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">작성자</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">작성일</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-[#2F4160] uppercase tracking-wider">관리</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        <tr th:each="resource, iterStat : ${resourcePage.content}"
            th:attr="data-url=@{'/resource/admin/detail/' + ${resource.resourceId}}"
            onclick="goToDetail(this)"
            class="cursor-pointer hover:bg-gray-50">
          <td class="px-6 py-4 text-sm text-gray-800 break-words text-center" th:text="${resourcePage.number * resourcePage.size + iterStat.index + 1}">1</td>
          <td class="px-6 py-4 text-sm font-medium text-gray-900 break-words text-center" th:text="${resource.title}">제목</td>
          <td class="px-6 py-4 text-sm text-gray-800 break-words text-center" th:text="${#strings.length(resource.content) > 30 ? #strings.substring(resource.content, 0, 30) + '...' : resource.content}">내용</td>
          <td class="p-3 border-b border-[#E0E0E0] text-center">
                        <span th:if="${resource.archive != null and !#strings.isEmpty(resource.archive)}" class="flex justify-center items-center gap-1.5 text-sm">
                            <a th:href="@{'/resource/admin/preview/' + ${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}}"
                               th:title="${resource.originalFileName}"
                               onclick="event.stopPropagation();"
                               class="text-[#2F4160] p-1 px-2 rounded-md hover:bg-[#2F4160] hover:text-white hover:no-underline transition duration-300">
                                <i class="fas fa-eye mr-1"></i>보기
                            </a>
                            <span class="text-gray-400 select-none">|</span>
                            <a th:href="@{'/resource/download/file/' + ${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}}"
                               th:title="${resource.originalFileName}"
                               onclick="event.stopPropagation();"
                               class="text-[#2F4160] p-1 px-2 rounded-md hover:bg-[#2F4160] hover:text-white hover:no-underline transition duration-300">
                                <i class="fas fa-download mr-1"></i>다운로드
                            </a>
                        </span>
            <span th:if="${resource.archive == null or #strings.isEmpty(resource.archive)}" class="text-gray-400">파일 없음</span>
          </td>
          <td class="px-6 py-4 text-sm text-gray-800 break-words text-center">관리자</td>
          <td class="px-6 py-4 text-sm text-gray-800 break-words text-center" th:text="${#temporals.format(resource.createDate, 'yyyy-MM-dd')}">2025-08-01</td>
          <td class="px-6 py-4 text-sm font-medium text-center">
            <div class="flex justify-center items-center space-x-2">
              <a th:href="@{'/resource/sujung/' + ${resource.resourceId}}"
                 class="bg-[#4B4B4B] text-white font-semibold py-1 px-3 rounded-lg hover:bg-[#2F4160] transition duration-300"
                 onclick="event.stopPropagation();"><i class="fas fa-edit"></i> 수정</a>
              <button type="button"
                      class="bg-red-500 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-600 transition duration-300 ml-2"
                      th:onclick="'event.stopPropagation(); confirmDelete(' + ${resource.resourceId} + ');'">
                <i class="fas fa-trash"></i> 삭제
              </button>
            </div>
          </td>
        </tr>
        <tr th:if="${resourcePage.content.size() == 0}">
          <td colspan="7" class="text-center p-4 text-gray-600">검색 결과가 없습니다.</td>
        </tr>
        </tbody>
      </table>

  <div class="pb-8 mt-8">
    <ul class="flex justify-center items-center space-x-2">
      <li class="page-item">
        <a th:href="@{|/resource/admin/main?page=0&keyword=${keyword}|}"
           class="pagination-item-base"
           th:classappend="${!resourcePage.hasPrevious()} ? ' disabled'">처음</a>
      </li>
      <li class="page-item">
        <a th:href="@{|/resource/admin/main?page=${resourcePage.number - 1}&keyword=${keyword}|}"
           class="pagination-item-base"
           th:classappend="${!resourcePage.hasPrevious()} ? ' disabled'">이전</a>
      </li>

      <li th:each="i : ${#numbers.sequence(0, resourcePage.totalPages - 1)}" class="page-item">
        <a th:href="@{|/resource/admin/main?page=${i}&keyword=${keyword}|}"
           th:text="${i + 1}"
           class="pagination-item-base"
           th:classappend="${i == resourcePage.number} ? ' active'">1</a>
      </li>

      <li class="page-item">
        <a th:href="@{|/resource/admin/main?page=${resourcePage.number + 1}&keyword=${keyword}|}"
           class="pagination-item-base"
           th:classappend="${!resourcePage.hasNext()} ? ' disabled'">다음</a>
      </li>
      <li class="page-item">
        <a th:href="@{|/resource/admin/main?page=${resourcePage.totalPages - 1}&keyword=${keyword}|}"
           class="pagination-item-base"
           th:classappend="${!resourcePage.hasNext()} ? ' disabled'">마지막</a>
      </li>
    </ul>
  </div>

</div>

<script>
  function confirmDelete(resourceId) {
      if (confirm('정말 이 자료를 삭제하시겠습니까?')) {
          window.location.href = '/resource/delete/' + resourceId;
      }
  }

  function goToDetail(row) {
      const url = row.getAttribute('data-url');
      if (url) {
          window.location.href = url;
      }
  }

  function handlePreviewClick(event) {
      event.stopPropagation();
      event.preventDefault();

      const target = event.currentTarget;
      const filename = target.getAttribute('data-filename');
      if (filename) {
          window.location.href = '/resource/admin/preview/' + filename;
      }
  }
</script>

<div th:replace="~{fragments/footer :: footerFragment}"></div>
</body>
</html>