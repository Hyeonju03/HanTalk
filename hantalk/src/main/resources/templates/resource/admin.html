<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>관리자 자료실</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    body {
      font-family: 'Nanum Gothic', '맑은 고딕', sans-serif;
    }
    /* 테이블 행 클릭 시 URL 이동을 위한 커서 스타일 */
    .table-row-clickable {
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 flex min-h-screen">

<!-- Sidebar (Navigation) -->
<nav class="w-64 bg-white shadow-lg p-6 flex flex-col justify-between fixed h-full">
  <div>
    <h2 class="text-xl font-bold text-indigo-700 mb-6">📁 메뉴</h2>
    <ul class="space-y-4">
      <li>
        <a href="/resource/main" class="flex items-center text-gray-600 hover:text-indigo-700 transition duration-300">
          <i class="fas fa-user-circle mr-3"></i>
          <span>사용자 메인</span>
        </a>
      </li>
      <li>
        <a href="/resource/admin/main" class="flex items-center text-gray-600 hover:text-indigo-700 transition duration-300">
          <i class="fas fa-cogs mr-3"></i>
          <span>관리자 메인</span>
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Main Content -->
<main class="flex-1 p-10 ml-64">
  <div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-extrabold text-indigo-700">관리자 자료실</h1>
      <a th:href="@{/resource/chuga}" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md flex items-center">
        <i class="fas fa-plus mr-2"></i>
        자료 등록하기
      </a>
    </div>

    <form class="search-form text-center mb-6" th:action="@{/resource/admin/main}" method="get">
      <input type="text" name="keyword" th:value="${keyword}" placeholder="검색어를 입력하세요" class="p-2 border border-gray-300 rounded-lg w-72 focus:outline-none focus:border-indigo-500" />
      <button type="submit" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 ml-2">
        <i class="fas fa-search mr-1"></i>검색
      </button>
    </form>

    <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-indigo-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">번호</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">제목</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">내용</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">파일</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">작성자</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">작성일</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider">관리</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        <tr th:each="resource, iterStat : ${resourcePage.content}"
            th:attr="data-url=@{'/resource/admin/detail/' + ${resource.resourceId}}"
            onclick="goToDetail(this)"
            class="hover:bg-indigo-50 transition duration-150 table-row-clickable">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" th:text="${resourcePage.number * resourcePage.size + iterStat.index + 1}">1</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" th:text="${resource.title}">제목</td>
          <td class="px-6 py-4 text-sm text-gray-500" th:text="${#strings.length(resource.content) > 30} ? ${#strings.substring(resource.content, 0, 30)} + '...' : ${resource.content}">내용</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <span th:if="${resource.archive != null and !#strings.isEmpty(resource.archive)}">
                <a th:href="@{'/resource/admin/preview/' + ${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}}"
                   th:title="${resource.originalFileName}"
                   onclick="event.stopPropagation();"
                   class="text-blue-500 hover:text-blue-700 hover:underline transition duration-300">
                  <i class="fas fa-eye mr-1"></i>보기
                </a>
                |
                <a th:href="@{'/resource/download/file/' + ${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}}"
                   th:title="${resource.originalFileName}"
                   onclick="event.stopPropagation();"
                   class="text-blue-500 hover:text-blue-700 hover:underline transition duration-300">
                  <i class="fas fa-download mr-1"></i>다운로드
                </a>
              </span>
            <span th:if="${resource.archive == null or #strings.isEmpty(resource.archive)}" class="text-gray-400">파일 없음</span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">관리자</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" th:text="${#temporals.format(resource.createDate, 'yyyy-MM-dd')}">2025-08-01</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <a th:href="@{'/resource/sujung/' + ${resource.resourceId}}"
               class="bg-green-600 text-white font-semibold py-1 px-3 rounded-lg hover:bg-green-700 transition duration-300"
               onclick="event.stopPropagation();"><i class="fas fa-edit"></i> 수정</a>
            <button type="button"
                    class="bg-red-600 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-700 transition duration-300 ml-2"
                    th:onclick="'event.stopPropagation(); confirmDelete(' + ${resource.resourceId} + ');'">
              <i class="fas fa-trash"></i> 삭제
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex justify-center mt-8 space-x-2">
      <span th:if="${resourcePage.hasPrevious()}" class="inline-flex">
        <a th:href="@{|/resource/admin/main?page=${resourcePage.number - 1}&keyword=${keyword}|}" class="bg-gray-200 text-gray-600 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300">이전</a>
      </span>

      <span th:each="pageNum : ${#numbers.sequence(0, resourcePage.totalPages - 1)}" class="inline-flex">
        <a th:href="@{|/resource/admin/main?page=${pageNum}&keyword=${keyword}|}"
           th:text="${pageNum + 1}"
           th:classappend="${pageNum == resourcePage.number} ? 'bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md' : 'bg-gray-200 text-gray-600 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300'">1</a>
      </span>

      <span th:if="${resourcePage.hasNext()}" class="inline-flex">
        <a th:href="@{|/resource/admin/main?page=${resourcePage.number + 1}&keyword=${keyword}|}" class="bg-gray-200 text-gray-600 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300">다음</a>
      </span>
    </div>
  </div>
</main>
<script>
  function confirmDelete(resourceId) {
    if (confirm('정말 이 자료를 삭제하시겠습니까?')) {
      // 실제로는 AJAX DELETE 요청을 보내는 것이 더 좋습니다.
      // 여기서는 예시로 GET 요청을 사용하지만, DELETE 요청으로 변경하는 것을 권장합니다.
      window.location.href = '/resource/delete/' + resourceId;
    }
  }

  function goToDetail(row) {
    const url = row.getAttribute('data-url');
    if (url) {
      window.location.href = url;
    }
  }
</script>
</body>
</html>
