<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>자료 미리보기</title>

  <!-- Google Fonts & Tailwind CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#fefcff] text-[#444] font-[Nanum_Gothic,_맑은_고딕,_sans-serif] min-h-screen flex flex-col">

<!-- 헤더 -->
<div th:replace="~{fragments/header :: headerFragment}"></div>

<div class="flex flex-1 w-full max-w-5xl mx-auto px-4 py-8 gap-8">

  <!-- 사이드바 -->
  <nav class="w-48 bg-[#f2f6ff] p-6 rounded shadow-md flex-shrink-0">
    <h2 class="text-xl font-bold mb-6 text-[#5e7bb4]">📁 메뉴</h2>
    <ul class="space-y-3">
      <li><a th:href="@{/resource/admin/main}" class="text-[#4e6cb2] hover:underline" th:if="${isAdmin}">관리자 목록</a></li>
      <li><a th:href="@{/resource/main}" class="text-[#4e6cb2] hover:underline" th:unless="${isAdmin}">사용자 목록</a></li>
    </ul>
  </nav>

  <!-- 본문 -->
  <main class="flex-1 bg-white p-8 rounded shadow-md">
    <h1 class="text-3xl font-bold mb-8 text-[#5e7bb4] border-b pb-3">자료 미리보기</h1>

    <!-- 제목 -->
    <div class="mb-4 flex">
      <span class="font-semibold text-gray-700 w-28 flex-shrink-0">제목</span>
      <span class="text-gray-900" th:text="${resource?.title} ?: ${fileName}">제목이 표시됩니다</span>
    </div>

    <!-- 내용 -->
    <div class="mb-4 flex" th:if="${resource != null}">
      <span class="font-semibold text-gray-700 w-28 flex-shrink-0">내용</span>
      <span class="text-gray-900 whitespace-pre-wrap" th:text="${resource?.content}">내용이 표시됩니다</span>
    </div>

    <!-- 파일 미리보기 -->
    <section class="mb-6">
      <!-- 이미지 -->
      <img th:if="${isImage}" th:src="@{|/resource/image/${fileName}|}" alt="이미지 미리보기" class="max-w-full rounded shadow mb-4" />

      <!-- 오피스 파일 -->
      <iframe th:if="${isOfficeFile}" th:src="@{${googleViewerUrl}}" class="w-full h-96 rounded shadow border-0 mb-4"></iframe>

      <!-- PDF / 문서 -->
      <iframe th:if="${isDocument and !isOfficeFile and !isText}" th:src="@{|/resource/view/file/${fileName}|}" class="w-full h-96 rounded shadow border-0 mb-4"></iframe>

      <!-- 텍스트 -->
      <pre th:if="${isText}" th:text="${textContent}" class="bg-[#e9f1f7] text-[#1e3a8a] p-4 rounded max-h-96 overflow-auto mb-4 font-mono whitespace-pre-wrap"></pre>

      <!-- 미지원 파일 안내 -->
      <p th:if="${!isImage and !isDocument and !isText}" class="text-red-500 font-semibold">미리보기를 지원하지 않는 파일입니다. 다운로드해 주세요.</p>
    </section>

    <!-- 파일 다운로드 -->
    <div class="mb-6 flex">
      <span class="font-semibold text-gray-700 w-28 flex-shrink-0">파일 다운로드</span>
      <span>
          <a th:if="${resource != null and resource.archive != null and !#strings.isEmpty(resource.archive)}"
             th:href="@{|/resource/download/file/${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}|}"
             download
             class="text-[#4e6cb2] hover:underline font-semibold"
             th:text="${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}">파일 다운로드</a>
          <span th:unless="${resource != null and resource.archive != null and !#strings.isEmpty(resource.archive)}" class="text-gray-500">파일이 없습니다.</span>
        </span>
    </div>

    <!-- 등록일 -->
    <div class="mb-6 flex" th:if="${resource != null}">
      <span class="font-semibold text-gray-700 w-28 flex-shrink-0">등록일</span>
      <span class="text-gray-900" th:text="${#temporals.format(resource.createDate, 'yyyy-MM-dd')}">2025-08-01</span>
    </div>

    <!-- 뒤로가기 버튼 -->
    <div class="text-center mt-6">
      <button type="button"
              th:text="${isAdmin} ? '관리자 목록으로' : '사용자 목록으로'"
              th:onclick="${isAdmin} ? 'location.href=\'/resource/admin/main\'' : 'location.href=\'/resource/main\''"
              class="bg-[#4e6cb2] hover:bg-[#3b5490] text-white px-4 py-2 rounded font-semibold">
        목록으로
      </button>
    </div>
  </main>
</div>

<!-- 푸터 -->
<div th:replace="~{fragments/footer :: footerFragment}"></div>

</body>
</html>
