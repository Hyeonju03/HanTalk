<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자료 미리보기</title>

  <!-- Google Fonts & Tailwind CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#f3f4f6] text-[#2F4160] font-[Nanum_Gothic,_맑은_고딕,_sans-serif] min-h-screen flex flex-col">

<!-- 헤더 -->
<div th:replace="~{fragments/header :: headerFragment}"></div>

<div class="flex flex-1 w-full max-w-5xl mx-auto px-4 py-8 gap-8">

  <!-- 사이드바 -->
  <nav class="w-72 bg-[#B5D0E3]/80 border-r border-[#B5D0E3]/50 p-4 shadow-lg flex flex-col backdrop-blur-sm flex-shrink-0">
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-[#2F4160]">📁 메뉴</h2>
    </div>
    <ul class="space-y-2">
      <!-- '관리자 목록' 링크가 제거되었습니다. -->
      <li><a th:href="@{/resource/main}" class="flex items-center p-3 text-[#2F4160] hover:bg-[#F29DA0]/80 rounded-lg transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
        </svg>
        <span>사용자 목록</span></a></li>
    </ul>
  </nav>

  <!-- 본문 -->
  <main class="flex-1 bg-white p-8 rounded-xl shadow-xl">
    <h1 class="text-3xl font-bold mb-8 text-[#2F4160] border-b border-[#E0E0E0] pb-3">자료 미리보기</h1>

    <!-- 제목 -->
    <div class="mb-4 flex flex-col sm:flex-row sm:items-start">
      <span class="font-semibold text-gray-700 sm:w-28 sm:flex-shrink-0 mb-1 sm:mb-0">제목</span>
      <span class="text-[#2F4160]" th:text="${resource?.title} ?: ${fileName}">제목이 표시됩니다</span>
    </div>

    <!-- 내용 -->
    <div class="mb-4 flex flex-col sm:flex-row sm:items-start" th:if="${resource != null}">
      <span class="font-semibold text-gray-700 sm:w-28 sm:flex-shrink-0 mb-1 sm:mb-0">내용</span>
      <span class="text-[#2F4160] whitespace-pre-wrap" th:text="${resource?.content}">내용이 표시됩니다</span>
    </div>

    <!-- 파일 미리보기 -->
    <section class="mb-6">
      <!-- 이미지 -->
      <img th:if="${isImage}" th:src="@{|/resource/image/${fileName}|}" alt="이미지 미리보기" class="max-w-full rounded-md shadow border border-[#E0E0E0] mb-4" />

      <!-- 오피스 파일 -->
      <iframe th:if="${isOfficeFile}" th:src="@{${googleViewerUrl}}" class="w-full h-96 rounded-md shadow border border-[#E0E0E0] mb-4"></iframe>

      <!-- PDF / 문서 -->
      <iframe th:if="${isDocument and !isOfficeFile and !isText}" th:src="@{|/resource/view/file/${fileName}|}" class="w-full h-96 rounded-md shadow border border-[#E0E0E0] mb-4"></iframe>

      <!-- 텍스트 -->
      <pre th:if="${isText}" th:text="${textContent}" class="bg-[#B5D0E3] text-[#2F4160] p-4 rounded-md max-h-96 overflow-auto mb-4 font-mono whitespace-pre-wrap"></pre>

      <!-- 미지원 파일 안내 -->
      <p th:if="${!isImage and !isDocument and !isText}" class="text-red-500 font-semibold text-center">미리보기를 지원하지 않는 파일입니다. 목록에서 다운로드해 주세요.</p>
    </section>

    <!-- 파일 다운로드 -->
    <div class="mb-6 flex flex-col sm:flex-row sm:items-start">
      <span class="font-semibold text-gray-700 sm:w-28 sm:flex-shrink-0 mb-1 sm:mb-0">파일 다운로드</span>
      <span>
          <a th:if="${resource != null and resource.archive != null and !#strings.isEmpty(resource.archive)}"
             th:href="@{|/resource/download/file/${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}|}"
             download
             class="text-[#2F4160] hover:underline font-semibold"
             th:text="${#strings.substring(resource.archive, resource.archive.lastIndexOf('/') + 1)}">파일 다운로드</a>
        <!-- '파일이 없습니다.' 멘트를 '목록에 가서 다운하기'로 변경 -->
          <span th:unless="${resource != null and resource.archive != null and !#strings.isEmpty(resource.archive)}" class="text-gray-500">목록에 가서 다운하기</span>
        </span>
    </div>

    <!-- 등록일 -->
    <div class="mb-6 flex flex-col sm:flex-row sm:items-start" th:if="${resource != null}">
      <span class="font-semibold text-gray-700 sm:w-28 sm:flex-shrink-0 mb-1 sm:mb-0">등록일</span>
      <span class="text-[#2F4160]" th:text="${#temporals.format(resource.createDate, 'yyyy-MM-dd')}">2025-08-01</span>
    </div>

    <!-- 뒤로가기 버튼 -->
    <div class="text-center mt-6">
      <button type="button"
              th:text="${isAdmin} ? '관리자 목록으로' : '사용자 목록으로'"
              th:onclick="${isAdmin} ? 'location.href=\'/resource/admin/main\'' : 'location.href=\'/resource/main\''"
              class="bg-[#F29DA0] hover:bg-[#2F4160] text-white px-4 py-2 rounded-lg font-semibold transition duration-300">
        목록으로
      </button>
    </div>
  </main>
</div>

<!-- 푸터 -->
<div th:replace="~{fragments/footer :: footerFragment}"></div>

</body>
</html>
